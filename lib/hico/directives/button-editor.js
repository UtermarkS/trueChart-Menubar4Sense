var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};require.config({bundles:{"assets/client/client":["general.services/media-library/media-library","client.property-panel/components/string/string","client.property-panel/components/slider/slider"]}}),define(["require","angular","qvangular","jquery","ng!$timeout","text!./button-editor.html","../prefix","./button","./media-library","../translations/translation","../services/qlik-service","../../external/leonardo-ui/leonardo-ui","../../external/toastr/toastr.min","./codemirror","css!../../external/toastr/toastr.css","../../external/jquery/jquery.slimscroll","../../general/icons-fa","../../general/icons-lui","client.property-panel/components/string/string","client.property-panel/components/slider/slider"],function(e,t,i,o,n,r,l,s,a,u,c,p,g){function f(){return{restrict:"A",scope:{state:"<",condition:"<",buttonName:"<",defaultStyles:"<"},controller:["$scope","$element",l+"ActionService",d],controllerAs:"$ctrl",template:r}}function d(e,i,r){function l(){f.forEach(function(e){e()})}function s(){var i=c.state&&c.state.style,o=i&&i.background.image;m.evalExpression(o).then(function(i){a.show({scope:e,mediaUrl:i,onConfirm:function(e){c.setBackgroundImageUrl(e)},onCancel:function(){t.noop()}})})}var c=this,f=[];i.on("$destroy",l),c.ready=!1,c.state=JSON.parse(JSON.stringify(e.state)),c.actionService=r,c.trans=u.getTranslation,c.openMediaLibrary=s,e.buttonName?e.title=e.buttonName:f.push(e.$watch("$ctrl.state.text",this.evalEditorTitle)),this.getScope=function(){return e},this.apply=function(){this.check()?(o(i).trigger({type:"apply",state:this.state}),this.close()):g.info(c.trans("FILL_ALL_REQUESTED_FIELDS"))},this.cancel=function(){o(i).trigger({type:"cancel"}),this.close()},this.check=function(){return 0===i.find("input[required]").filter(function(){return""===this.value}).length},this.close=function(){i.remove(),e.$destroy()},n(function(){i.find("[data-tabset]").each(function(){p.tabset({element:this})}),i.find(".slimscroll").slimScroll({height:"100%",width:"100%"}),i.find(".editor").draggable({handle:" .lui-dialog__header"}),h(),c.ready=!0,i.removeClass("hidden")})}function h(){t.element(".editor #hico-action-triggers ul.action-list > li > ul.lui-list").sortable({axis:"y",handle:" .sortable-handle",placeholder:"action-item-placeholder",forcePlaceholderSize:!0,stop:y})}function y(){for(var e,i=t.element(this),o=i.find("li.action-item.ng-scope"),n=i.scope(),r=n.trigger,l=0,s=o.length;l<s;l++)e=o[l],e.style.top="",e.style.left="",r.actions[l]=t.element(e).scope().action}function b(){return{styles:{custom:{type:"css",value:"background: transparent url(../extensions/trueChart/img/logo.png) no-repeat center"},image:{type:"image",value:"url(../extensions/trueChart/img/logo.png)"}},buttonTypes:s.types,buttonStates:{normal:{value:void 0,label:"normal"},active:{value:"active",label:"active"},disabled:{value:"disabled",label:"disabled"}},fontFamilies:function(){try{return HiCo.Utils.GlobalFunctions.getFontTypes().map(function(e){return{value:e.id,label:e.translation}})}catch(e){return[{value:"Arial",label:"Arial"},{value:"Arial Unicode MS",label:"Arial Unicode MS"},{value:"Calibri",label:"Calibri"},{value:"Tahoma",label:"Tahoma"},{value:"Verdana",label:"Verdana"},{value:"QlikView Sans",label:"QlikView Sans"}]}}(),fontWeights:{normal:{value:"normal",label:"normal"},bold:{value:"bold",label:"bold"},bolder:{value:"bolder",label:"bolder"},lighter:{value:"lighter",label:"lighter"},number:{value:"100",label:"number (100-900)"}},fontStyles:{normal:{value:"normal",label:"normal"},italic:{value:"italic",label:"italic"},oblique:{value:"oblique",label:"oblique"}},xPositions:{center:{value:void 0,label:"center"},left:{value:"left",label:"left"},right:{value:"right",label:"right"}},yPositions:{center:{value:void 0,label:"center"},top:{value:"top",label:"top"},bottom:{value:"bottom",label:"bottom"}},bgImageSizes:{original:{value:void 0,label:"original"},cover:{value:"cover",label:"cover"},contain:{value:"contain",label:"contain"},stretch:{value:"100% 100%",label:"stretch"}},bgRepeateOptions:{repeat:{value:"repeat",label:"repeat"},"repeat-x":{value:"repeat-x",label:"repeat-x"},"repeat-y":{value:"repeat-y",label:"repeat-y"},"no-repeat":{value:"no-repeat",label:"no-repeat"},initial:{value:"initial",label:"initial"},inherit:{value:"inherit",label:"inherit"}},widthList:{auto:{value:void 0,label:"auto"},full:{value:"100%",label:"full"},custom:{value:"100px",label:"custom"}},heightList:{auto:{value:void 0,label:"auto"},full:{value:"100%",label:"full"},custom:{value:"40px",label:"custom"}}}}var m=c.getInstance();return g.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-bottom-right",preventDuplicates:!0,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"2000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},i.directive(l+"ButtonEditor",[f]),d.prototype={addTrigger:function(e){var t,i=new s.Trigger,o=this.triggers,n=this.usedTriggers;if(n)if(n.length<o.length-1){for(t=0;t<o.length;t++)if(-1===n.indexOf(o[t].type)){i.type=o[t].type,e.push(i);break}}else i.type="custom",0===e.filter(function(e){return"custom"===e.type&&!e.name}).length&&e.push(i)||g.warning("Please enter a valid trigger name, before a new custom trigger can be added");else e.push(i);this.updateUsedTriggers()},removeTrigger:function(e,t){e.splice(e.indexOf(t),1),this.updateUsedTriggers()},updateUsedTriggers:function(){this.usedTriggers=this.state.triggers.filter(function(e){return"custom"!==e.type}).map(function(e){return e.type})},getEditableTriggers:function(e){var t=this;return e.filter(function(e){return t.getAllowedActions(e.actions).length>0||0===e.actions.length})},isUsableTrigger:function(e,t){return!(-1!==this.usedTriggers.indexOf(e.type)||t&&t.some(function(t){var i=this.actions[t.name];return!!i.supportedTriggers&&-1===i.supportedTriggers.indexOf(e.type)},this))},onTriggerChange:function(){this.updateUsedTriggers()},addAction:function(e,t){t=void 0===t?0:t+1,e.splice(t,0,new s.Action),h()},removeAction:function(e,t){e.splice(e.indexOf(t),1)},getAllowedActions:function(e){var t=this;return e.filter(function(e){return!!t.actions[e.name]})},getUsableActions:function(e,t){var i,o,n={};for(o in e)i=e[o],!0===i.isHidden||t&&i.supportedTriggers&&-1===i.supportedTriggers.indexOf(t)||(n[o]=i);return n},toggleCollapsible:function(e){return t.element(e.currentTarget).find(".lui-icon").toggleClass("lui-icon--arrow-up lui-icon--arrow-down"),!1},setCustomStyle:function(e,t){if("expression"===t&&"object"!==_typeof(e.custom)){var i=e.custom||"";0!==i.indexOf("=")&&(i="="+i),e.custom={qStringExpression:{qExpr:i}}}else if("plain"===t&&e.custom&&e.custom.qStringExpression){var o=e.custom.qStringExpression.qExpr;e.custom=0!==o.indexOf("=")?o:o.substr(1,o.length-1)}},resetCustomStyle:function(){this.state.style.custom=this.parameters.styles.custom.value},resetBackgroundImage:function(){this.state.style.background.image=this.parameters.styles.image.value},setBackgroundImageUrl:function(e){this.state.style.background.image=e},setIcon:function(e){this.state.icon=e},setIconPosition:function(e){t.extend(this.state.layout,{icon:{position:e}})},getIconPosition:function(){try{return this.state.layout.icon.position||"left"}catch(e){return"left"}},qComponents:{string:e("client.property-panel/components/string/string"),slider:e("client.property-panel/components/slider/slider")},definitions:{text:{type:"string",ref:"text",expression:"optional"},tooltip:{type:"string",ref:"tooltip",expression:"optional"},icon:{type:"string",ref:"icon",expression:"optional"},buttonState:{type:"string",ref:"buttonState",expression:"optional"},style:{font:{hoverColor:{type:"string",ref:"style.font.hoverColor",expression:"optional"},color:{type:"string",ref:"style.font.color",expression:"optional"},family:{type:"string",ref:"style.font.family",expression:"optional"},size:{type:"string",ref:"style.font.size",expression:"optional"},weight:{type:"string",ref:"style.font.weight",expression:"optional"},style:{type:"string",ref:"style.font.style",expression:"optional"}},icon:{size:{type:"slider",ref:"style.icon.size",min:0,max:5,defaultValue:0},hoverColor:{type:"string",ref:"style.icon.hoverColor",expression:"optional"},color:{type:"string",ref:"style.icon.color",expression:"optional"}},background:{color:{type:"string",ref:"style.background.color",expression:"optional"},hoverColor:{type:"string",ref:"style.background.hoverColor",expression:"optional"},image:{type:"string",ref:"style.background.image",expression:"optional",defaultValue:"../extensions/trueChart/img/logo.png"},position:{type:"string",ref:"style.background.position",expression:"optional"}},border:{hoverColor:{type:"string",ref:"style.border.hoverColor",expression:"optional"},color:{type:"string",ref:"style.border.color",expression:"optional"}},custom:{type:"string",ref:"style.custom",expression:"optional"}}},$onInit:function(){this.state;var t=this,i=e("../../general/icons-fa"),o=e("../../general/icons-lui");this.actions=this.getUsableActions(this.actionService.getActions()),this.triggers=this.actionService.getTriggers(),this.actionService.getParameters().then(function(e){t.params=e}),this.parameters=b(),this.tooltips={triggers:this.triggers.reduce(function(e,t){return e[t.type]=t.tooltip,e})},this.faIcons=[];for(var n in i)this.faIcons.push({value:n,label:i[n]});this.luiIcons=[];for(var n in o)this.luiIcons.push({value:n,label:o[n]});this.isTrue=function(){return!0};for(var r=0;r<10;r++)this.definitions["param"+r]={type:"string",ref:r.toString(),expression:"optional"};this.updateUsedTriggers()},evalEditorTitle:function(e,t,i){m.evalExpression(e).then(function(e){i.title=e||"Button"})},setBorder:function(e){var t=this.state.style.border||{};t.enabled=e,!0===e&&(t.width=t.width||1,t.style=t.style||"solid",t.color=t.color||"gray"),this.state.style.border=t},setHeight:function(e){this.state.layout.height=this.state.layout.height===e?void 0:e},setWidth:function(e){this.state.layout.width=this.state.layout.width===e?void 0:e},onTabSelected:function(e){switch(e){case"general":case"actions":this.getScope().$broadcast("CodeMirror",function(e){return n(function(){return e.refresh()})})}}},f.getParameters=b,f});